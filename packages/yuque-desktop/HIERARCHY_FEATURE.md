# 文档层级结构功能

## 功能概述

实现了语雀文档的层级结构展示，支持树形视图和列表视图切换。

## 主要变更

### 1. 数据库 Schema 更新 (v5)

在 `documents` 表中添加了以下字段：
- `uuid` - 文档的 UUID（语雀内部标识）
- `parent_uuid` - 父文档的 UUID
- `child_uuid` - 子文档的 UUID
- `doc_type` - 文档类型（`DOC` 或 `TITLE`，TITLE 表示目录）
- `depth` - 文档层级深度
- `sort_order` - 排序顺序

### 2. API 服务更新

**`electron/services/books.ts`**
- 更新 `getDocsOfBook` 函数，从语雀 API 获取完整的文档层级信息
- 保存文档的 `uuid`、`parent_uuid`、`child_uuid`、`type`、`depth` 等字段

### 3. 新增 UI 组件

**`src/components/DocumentTree.tsx`**
- 新的树形文档列表组件
- 支持展开/收起子文档
- 支持多级缩进显示
- 目录（TITLE 类型）显示文件夹图标
- 保留所有原有功能（预览、打开文件、在语雀中打开等）

### 4. 主界面更新

**`src/components/MainLayout.tsx`**
- 添加视图模式切换按钮（列表视图/树形视图）
- 默认使用树形视图
- 工具栏新增视图切换图标按钮

## 使用方法

### 切换视图模式

在工具栏右侧找到视图切换按钮：
- 📋 列表图标 - 切换到列表视图（平铺显示所有文档）
- 📁 文件夹图标 - 切换到树形视图（层级结构显示）

### 树形视图操作

- **展开/收起**：点击文档左侧的箭头图标
- **查看文档**：点击文档名称预览（已同步的文档）
- **操作按钮**：鼠标悬停显示操作按钮（预览、打开、在文件夹中显示、在语雀中打开）

## 数据迁移

现有数据库会自动迁移到 v5 版本：
- 自动添加新字段
- 现有文档的层级字段初始为 NULL
- 下次同步时会更新层级信息

## 技术细节

### 树形结构构建

`buildDocumentTree` 函数负责将平铺的文档列表转换为树形结构：
1. 创建文档 Map，以 UUID 为键
2. 遍历文档，根据 `parent_uuid` 建立父子关系
3. 没有父文档的作为根节点

### 性能优化

- 使用 `useMemo` 缓存树形结构，避免重复计算
- 按需渲染子节点（展开时才渲染）
- 保持原有的虚拟滚动性能

## 后续优化

1. **拖拽排序**：支持拖拽调整文档顺序
2. **搜索高亮**：在树形视图中高亮搜索结果
3. **路径面包屑**：显示当前文档的完整路径
4. **批量操作**：支持选择多个文档进行批量同步
5. **折叠状态持久化**：记住用户的展开/收起状态

## 测试建议

1. 同步一个包含多级目录的知识库
2. 切换列表视图和树形视图
3. 测试展开/收起功能
4. 验证文档操作（预览、打开等）在两种视图下都正常工作
